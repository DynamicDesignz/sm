#!/usr/bin/env bash

if array_is_nonempty extension_args
then
  # log "Installing extensions ${extension_args[*]} to ${extensions_path}\n"

  array_shift extension_args action

  if [[ -n "${extension_args[0]}" ]]
  then
    if path_exists "${extension_actions_path}/${namespace}/${action}" &&
       file_is_executable "${extension_actions_path}/${namespace}/${action}"
    then
      namespace="${action}"
      array_shift extension_args action
    fi
  fi

  array_shift extension_args extension

  case "${extension_version:-head}" in
    *([[:digit:]]).*([[:digit:]]).*([[:digit:]]))
      fetch_tarball
      ;;

    head|master)
      fetch_extensions_git_repository # default is head
      ;;
  esac

  extension_fetch_and_install "${extension}"

  if extension_action "${extension}" "${action}"
  then
    succeed
  else
    error "${extension} ${action} ${extension_args[*]} failed."
  fi
else
  fail "At least one extension name must be specified."
fi
