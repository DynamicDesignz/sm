#!/usr/bin/env bash

[[ -n "$extensions" ]] || fail "A extension must be specified."

for extension in ${extensions//,/ } ; do

  ensure_paths_exist "$src_path"

  if [[ -n "$head_flag" ]] ; then
    if [[ ! -d "$src_path/$extension/.git" ]] ; then
      "$scripts_path"/log "info" "Updating $extension repository."
      cd "$src_path/$extension"/.git
      # TODO: Branch update logic.
      git pull origin "${branch:-master}"
    else
      "$scripts_path"/log "info" "Cloning $extension repository from $extension_repo_url."
      cd "$src_path/$extension/"
      # TODO: git/hg/svn detection, git for now
      git clone "$extension_repo_url"
    fi
  else
    rm -rf "$src_path/latest"
    mkdir -p "$src_path/latest"
    curl -O "$releases_url" | tar xf - -C "$src_path/latest"
    # TODO: error check and exit on error.
    cd "$src_path/latest"/bdsm-*
    ./install
  fi

done

exit $result
