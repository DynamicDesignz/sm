#!/usr/bin/env bash

#
# need to figure out the following items
#  * Where extension will be stored (done)
#    => ${extensions_src_path}/${extension}/${version:-head}
#  * where to store metadata information, like extension repository url.
#  * Where extension sources will be stored
#  * How an extension will be updated
#
usage()
{
  log "

Usage:

  bdsm extensions update repository

"
}

extension_action=${extension_args[0]}

# TODO: Updates for released extensions instead of only from repository.
case "$extension_action" in
  repository)
    fetch_extensions_repository
    install_extensions "${extensions[@]}"
    log "Updated extensions: ${extensions[@]}"
  ;;

  help|usage)
    usage
  ;;

  all)
    extensions=($(installed_extensions))

    if [[ ${#extensions[@]} -gt 0 ]] ; then
      fetch_extensions_repository

      install_extensions "${extensions[@]}"
    else
      log "No extensions to update."
    fi
    ;;

  *)
    if [[ -d "${extensions_path}/${extension_action}/VERSION" ]] ; then
      fetch_extensions_repository

      install_extensions "${extension_action}" "${extension_args[@]}"
    else
      fetch_extensions_repository
    fi
  ;;
esac
