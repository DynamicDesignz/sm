#!/usr/bin/env bash

set +o nounset
set +o noclobber

: ${debug_flags:="-search"} ${debug_flag:=0} ${trace_flags:="-search"} ${trace_flag:=0}

while (( $# > 0 ))
do
  token="$1"
  case "$token" in

    --help)
      extension_args=("core" "help" "$@")
      break
      ;;

    -v|--version)
      extension_args=("core" "version" "$@")
      break
      ;;

    --trace)
      trace_flags+=" all"
      ;;

    --trace=*)
      trace_flags+=" ${token##--trace=}"
      ;;

    --debug)
      debug_flags+=" all"
      debug_flag=1
      ;;

    --debug=*)
      debug_flags+=" ${token##--debug=}"
      debug_flag=1
      ;;

    --)
      shift #end of processing
      extension_args=("$@")
      break
      ;;

    -*)
      error "Unknown flag '${token}'"
      ;;
    *)
      if [[ -f $token ]]
      then
        bdsm_script=$1
      else
        extension_args=("$@")
        break
      fi
      ;;
  esac
  shift
done

if (( $# == 0 )) && [[ -z "$extension_args" ]]
then
  extension_args=()
fi

case " ${trace_flags} " in
  (" all ")
    trace_flag=1
    set -x
    ;;
esac

debug_flags="${debug_flags## }"
trace_flags="${trace_flags## }"

export debug_flag debug_flags trace_flag trace_flags extension_args bdsm_script
