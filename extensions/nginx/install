#!/usr/bin/env bash

echo -e "\nNote: This will do a standard install. Use the 'passenger' extension for installing passenger Nginx.\n"

configure_flags=" --prefix=/usr/local/nginx --conf-path=/etc/nginx/nginx.conf --sbin-path=/usr/sbin/nginx --pid-path=/var/run/nginx.pid --lock-path=/var/lock/nginx.lock --http-client-body-temp-path=/var/spool/nginx/client_body_temp --http-proxy-temp-path=/var/spool/nginx/proxy_temp --http-fastcgi-temp-path=/var/spool/nginx/fastcgi_temp --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --with-imap --with-imap_ssl_module --with-http_ssl_module --with-http_stub_status_module --with-pcre"

source_path="${source_path:-/usr/local/src}"

mkdir -p $source_path && cd $source_path
package="nginx";version="0.7.65" ; archive_format="tar.gz"
packge_url="http://nginx.org/download/$package-$version.$archive_format"
curl -O -L $packge_url
tar zxf $package-$version.tar.gz
cd $package-$version
./configure $configure_flags
make &&
make install

mkdir -p /var/spool/nginx/client_body_temp

cp $extension_templates_path/nginx.conf.template /etc/nginx/
cp $extension_templates_path/proxy.conf.template /etc/nginx/conf/proxy.conf

